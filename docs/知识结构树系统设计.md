# 知识结构树系统设计文档

## 一、设计理念

### 1.1 核心思想
- **树状组织**：用树状结构替代传统的分类系统，知识以父子关系组织
- **拖拽管理**：支持拖拽调整知识在树中的位置和层级
- **上传时选择父节点**：上传知识时，可以选择添加到哪个节点的子节点
- **保留分类字段**：为了兼容性，保留 `category` 字段，但主要使用树结构

### 1.2 数据结构
```
知识树结构示例：
├── 技术文档
│   ├── 前端开发
│   │   ├── Vue.js 教程
│   │   └── React 教程
│   └── 后端开发
│       ├── Spring Boot 指南
│       └── 数据库设计
├── 业务文档
│   ├── 产品需求
│   └── 运营手册
└── 培训资料
    ├── 新员工培训
    └── 技术分享
```

## 二、数据库设计

### 2.1 现有字段
- `parent_id` BIGINT - 父节点ID，NULL表示根节点
- `sort_order` INT - 排序顺序，同级节点按此排序

### 2.2 需要添加的索引
```sql
-- 添加父节点索引，优化树查询
ALTER TABLE `knowledge` ADD INDEX `idx_parent_id` (`parent_id`);
-- 添加排序索引
ALTER TABLE `knowledge` ADD INDEX `idx_parent_sort` (`parent_id`, `sort_order`);
```

### 2.3 字段说明
- `parent_id = NULL`：根节点（顶级知识）
- `parent_id != NULL`：子节点，指向父知识ID
- `sort_order`：同级节点排序，数字越小越靠前

## 三、后端API设计

### 3.1 获取知识树
```
GET /api/knowledge/tree
返回：扁平列表，前端构建树结构
```

### 3.2 移动知识节点
```
PUT /api/knowledge/{id}/move
Body: { parentId: Long, sortOrder: Integer }
```

### 3.3 获取知识路径（面包屑）
```
GET /api/knowledge/{id}/path
返回：从根节点到当前节点的路径数组
```

### 3.4 获取子节点列表
```
GET /api/knowledge/{id}/children
返回：直接子节点列表
```

### 3.5 创建知识时指定父节点
```
POST /api/knowledge
Body: { ..., parentId: Long }
```

## 四、前端设计

### 4.1 上传对话框改进
- 添加"选择父节点"选择器
- 支持树形选择器（el-tree-select）
- 可选：如果不选择，则创建为根节点

### 4.2 知识列表页面改进
- **方案1**：添加"树形视图"切换按钮，支持列表视图和树形视图
- **方案2**：添加"父节点筛选"，可以筛选某个节点的子节点
- **方案3**：在列表中添加"路径"列，显示知识在树中的位置

### 4.3 知识树管理页面
- 完善拖拽功能
- 支持右键菜单（添加子节点、移动、删除）
- 支持搜索和定位节点
- 支持展开/折叠全部

### 4.4 知识详情页面
- 显示知识路径（面包屑导航）
- 显示父节点和子节点链接
- 支持"移动到"功能

## 五、实现步骤

1. **数据库优化**：添加索引
2. **后端API增强**：添加路径查询、子节点查询等
3. **上传流程改造**：添加父节点选择
4. **列表页面改造**：支持树形展示或路径显示
5. **树管理页面完善**：完善拖拽和操作功能
6. **搜索功能增强**：支持按树路径搜索

## 六、兼容性考虑

1. **保留category字段**：现有知识保留category，新知识主要使用树结构
2. **迁移策略**：可以提供一个工具，将category转换为树结构
3. **双重支持**：列表页面可以同时支持按category和按树结构筛选

